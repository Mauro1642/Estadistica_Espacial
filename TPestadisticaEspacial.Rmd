---
title: "Script"
output: html_document
date: "2025-07-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Dataset}
delitos <- read_excel("delitos_2023.xlsx")
delitos <- delitos[!(delitos$barrio == "NULL" & delitos$comuna == "NULL"), ]
```
```{r Limpieza de datos}
print(paste("Los tipos de delitos son:",unique(delitos$tipo))
)
```
```{r Analizamos los robos y hurtos}
df_robos<-delitos[delitos$tipo=="Robo" | delitos$tipo=="Hurto",]
# Cargar librerías necesarias
library(dplyr)
library(sf)
library(leaflet)

# Leer el mapa de barrios (GeoJSON oficial del GCBA)
url <- "https://cdn.buenosaires.gob.ar/datosabiertos/datasets/barrios/barrios.geojson"
barrios_sf <- st_read(url, quiet = TRUE)

# Armonizar nombres de barrios (por si hay diferencias de mayúsculas o tildes)
# Convertir ambos a mayúsculas para hacer el join correctamente
df_robos <- df_robos %>%
  mutate(barrio = toupper(barrio))

barrios_sf <- barrios_sf %>%
  mutate(NOMBRE = toupper(NOMBRE))

# Contar cantidad total de robos por barrio
robos_por_barrio <- df_robos %>%
  count(barrio, name = "cantidad")

# Unir los datos de robos al mapa
barrios_mapa <- barrios_sf %>%
  left_join(robos_por_barrio, by = c("NOMBRE" = "barrio"))

# Crear paleta de colores
pal <- colorNumeric(palette = "Reds", domain = barrios_mapa$cantidad, na.color = "gray90")

# Crear el mapa interactivo
leaflet(barrios_mapa) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(cantidad),
    weight = 1,
    color = "white",
    fillOpacity = 0.7,
    label = ~paste0(NOMBRE, ": ", ifelse(is.na(cantidad), 0, cantidad), " robos"),
    highlightOptions = highlightOptions(
      weight = 2,
      color = "#444",
      fillOpacity = 0.9,
      bringToFront = TRUE
    )
  ) %>%
  addLegend(pal = pal, values = ~cantidad, opacity = 0.7,
            title = "Robos por barrio", position = "bottomright")

```
## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
